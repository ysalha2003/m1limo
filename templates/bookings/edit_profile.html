{% extends "base.html" %}
{% load humanize %}

{% block title %}Account Settings - M1 Limousine Service{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <div class="welcome-banner">
        <h1 style="font-size: 28px; font-weight: 700; margin-bottom: 8px;">Account Settings</h1>
        <p style="color: var(--text-secondary);">Manage your account information and booking activity</p>
    </div>

    <!-- Account Statistics Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 28px;">
        <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p class="stat-label">Total Bookings</p>
                    <p class="stat-value">{{ total_bookings|default:0 }}</p>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary-light) 0%, #e2e8f0 100%);">
                    <svg style="width: 24px; height: 24px; color: var(--primary); position: relative; z-index: 1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p class="stat-label">Active</p>
                    <p class="stat-value" style="color: var(--success);">{{ active_bookings|default:0 }}</p>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--success-light) 0%, #a7f3d0 100%);">
                    <svg style="width: 24px; height: 24px; color: var(--success); position: relative; z-index: 1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p class="stat-label">Completed</p>
                    <p class="stat-value" style="color: var(--info);">{{ completed_trips|default:0 }}</p>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--info-light) 0%, #bfdbfe 100%);">
                    <svg style="width: 24px; height: 24px; color: var(--info); position: relative; z-index: 1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <p class="stat-label">Member Since</p>
                    <p class="stat-value" style="font-size: 20px; color: var(--text-primary);">{{ user.date_joined|date:"M Y" }}</p>
                </div>
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary-light) 0%, #e2e8f0 100%);">
                    <svg style="width: 24px; height: 24px; color: var(--primary); position: relative; z-index: 1;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 320px 1fr; gap: 24px;" class="profile-grid">
        <!-- Left Column - Account Information Card -->
        <div>
            <div class="card">
                <div style="padding-bottom: 20px; border-bottom: 2px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                        <div style="width: 64px; height: 64px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: var(--shadow-sm);">
                            <span style="color: white; font-size: 28px; font-weight: 700;">
                                {{ user.first_name|first|upper|default:user.username|first|upper }}
                            </span>
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <h2 style="font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 2px;">
                                {% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}
                            </h2>
                            <p style="color: var(--text-secondary); font-size: 13px;">@{{ user.username }}</p>
                        </div>
                    </div>
                </div>

                <div style="padding-top: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Contact Email</label>
                        <div style="font-weight: 500; color: var(--dark); font-size: 14px; word-break: break-word;">{{ user.email|default:"Not provided" }}</div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Phone Number</label>
                        <div style="font-weight: 500; color: var(--dark); font-size: 14px;">{{ user_profile.phone_number|default:"Not provided" }}</div>
                    </div>

                    {% if user_profile.company_name %}
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Company</label>
                        <div style="font-weight: 500; color: var(--primary); font-size: 14px; display: flex; align-items: center; gap: 6px;">
                            <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                            {{ user_profile.company_name }}
                        </div>
                    </div>
                    {% endif %}

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Account Status</label>
                        <div style="display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: linear-gradient(135deg, var(--success-light) 0%, #a7f3d0 100%); border-radius: 999px; font-size: 12px; font-weight: 600; color: #047857;">
                            <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Active
                        </div>
                    </div>

                    <div>
                        <label style="display: block; color: var(--text-secondary); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px;">Your Username</label>
                        <div style="font-weight: 500; color: var(--dark); font-size: 14px;">{{ user.username }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Tabbed Content -->
        <div>
            <div class="card" style="padding: 0; overflow: hidden;">
                <div style="display: flex; border-bottom: 2px solid var(--border);">
                    <button class="profile-tab active" data-tab="overview">
                        <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        Account Info
                    </button>
                    <button class="profile-tab" data-tab="security">
                        <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        Security
                    </button>
                    <button class="profile-tab" data-tab="activity">
                        <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Booking Activity
                    </button>
                </div>

                <div style="padding: 28px;">
                    <!-- Account Info Tab -->
                    <div id="overview-content" class="tab-content">
                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 6px;">Update Account Information</h3>
                            <p style="color: var(--text-secondary); font-size: 14px;">Manage your personal details and contact information</p>
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="update_profile" value="1">

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label" for="id_first_name">First Name</label>
                                    <input type="text" name="first_name" id="id_first_name" class="form-input"
                                           value="{{ user.first_name }}" maxlength="30" required>
                                </div>

                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label" for="id_last_name">Last Name</label>
                                    <input type="text" name="last_name" id="id_last_name" class="form-input"
                                           value="{{ user.last_name }}" maxlength="150" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="id_email">Email Address</label>
                                <input type="email" name="email" id="id_email" class="form-input"
                                       value="{{ user.email }}" maxlength="254" required>
                                <div style="color: var(--text-secondary); font-size: 12px; margin-top: 6px;">
                                    Used for booking confirmations and important notifications
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="id_phone_number">Phone Number</label>
                                <input type="tel" name="phone_number" id="id_phone_number" class="form-input"
                                       value="{{ user_profile.phone_number|default:'' }}" maxlength="20">
                                <div style="color: var(--text-secondary); font-size: 12px; margin-top: 6px;">
                                    Optional - for account-related communications
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="id_company_name">
                                    <svg style="width: 14px; height: 14px; display: inline-block; vertical-align: middle; margin-right: 4px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                    Company Name
                                </label>
                                <input type="text" name="company_name" id="id_company_name" class="form-input"
                                       value="{{ user_profile.company_name|default:'' }}" maxlength="200">
                                <div style="color: var(--text-secondary); font-size: 12px; margin-top: 6px;">
                                    Optional - helps us identify you in the system
                                </div>
                            </div>

                            <div style="padding-top: 16px; border-top: 1px solid var(--border);">
                                <button type="submit" class="btn btn-primary">
                                    <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Security Tab -->
                    <div id="security-content" class="tab-content" style="display:none;">
                        <!-- Password Section -->
                        <div style="margin-bottom: 32px;">
                            <div style="margin-bottom: 24px;">
                                <h3 style="font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 6px;">Change Password</h3>
                                <p style="color: var(--text-secondary); font-size: 14px;">Update your password to keep your account secure</p>
                            </div>

                            <form method="post">
                                {% csrf_token %}
                                <input type="hidden" name="change_password" value="1">

                                <div class="form-group">
                                    <label class="form-label" for="id_old_password">Current Password</label>
                                    <input type="password" name="old_password" id="id_old_password" class="form-input" required autocomplete="current-password">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="id_new_password1">New Password</label>
                                    <input type="password" name="new_password1" id="id_new_password1" class="form-input" required autocomplete="new-password">
                                    <div style="color: var(--text-secondary); font-size: 12px; margin-top: 6px;">
                                        Must be at least 8 characters long
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="id_new_password2">Confirm New Password</label>
                                    <input type="password" name="new_password2" id="id_new_password2" class="form-input" required autocomplete="new-password">
                                </div>

                                <div style="padding-top: 16px; border-top: 1px solid var(--border);">
                                    <button type="submit" class="btn btn-primary">
                                        <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                        </svg>
                                        Update Password
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Notification Preferences Section -->
                        <div style="padding-top: 32px; border-top: 2px solid var(--border);">
                            <div style="margin-bottom: 24px;">
                                <h3 style="font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 6px;">Email Notification Preferences</h3>
                                <p style="color: var(--text-secondary); font-size: 14px;">Choose which email notifications you'd like to receive</p>
                            </div>

                            <form method="post">
                                {% csrf_token %}
                                <input type="hidden" name="update_profile" value="1">
                                <!-- Include hidden fields for name and email to preserve them -->
                                <input type="hidden" name="first_name" value="{{ user.first_name }}">
                                <input type="hidden" name="last_name" value="{{ user.last_name }}">
                                <input type="hidden" name="email" value="{{ user.email }}">
                                <input type="hidden" name="phone_number" value="{{ user_profile.phone_number|default:'' }}">
                                <input type="hidden" name="company_name" value="{{ user_profile.company_name|default:'' }}">

                                <div style="background: linear-gradient(to bottom, white 0%, var(--light) 100%); border: 1px solid var(--border-light); border-radius: var(--radius-lg); padding: 20px;">
                                    <div style="display: flex; align-items: start; gap: 12px; margin-bottom: 16px;">
                                        <input type="checkbox" name="receive_booking_confirmations" id="id_receive_booking_confirmations" class="form-checkbox" {% if user_profile.receive_booking_confirmations %}checked{% endif %} style="margin-top: 2px;">
                                        <div style="flex: 1;">
                                            <label for="id_receive_booking_confirmations" style="font-weight: 600; color: var(--dark); font-size: 14px; cursor: pointer; display: block; margin-bottom: 4px;">Booking Confirmations</label>
                                            <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">Receive emails when your bookings are confirmed by our team</p>
                                        </div>
                                    </div>

                                    <div style="display: flex; align-items: start; gap: 12px; margin-bottom: 16px;">
                                        <input type="checkbox" name="receive_status_updates" id="id_receive_status_updates" class="form-checkbox" {% if user_profile.receive_status_updates %}checked{% endif %} style="margin-top: 2px;">
                                        <div style="flex: 1;">
                                            <label for="id_receive_status_updates" style="font-weight: 600; color: var(--dark); font-size: 14px; cursor: pointer; display: block; margin-bottom: 4px;">Status Updates</label>
                                            <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">Receive emails when your booking status changes (completed, cancelled, etc.)</p>
                                        </div>
                                    </div>

                                    <div style="display: flex; align-items: start; gap: 12px;">
                                        <input type="checkbox" name="receive_pickup_reminders" id="id_receive_pickup_reminders" class="form-checkbox" {% if user_profile.receive_pickup_reminders %}checked{% endif %} style="margin-top: 2px;">
                                        <div style="flex: 1;">
                                            <label for="id_receive_pickup_reminders" style="font-weight: 600; color: var(--dark); font-size: 14px; cursor: pointer; display: block; margin-bottom: 4px;">Pickup Reminders</label>
                                            <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">Receive reminder emails 24 hours before scheduled pickups</p>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-top: 16px; padding: 12px; background: var(--info-light); border-radius: var(--radius); border-left: 3px solid var(--info);">
                                    <p style="color: #1e40af; font-size: 13px; margin: 0;">
                                        <strong>Note:</strong> Passengers will always receive notifications at the email address provided in each booking, regardless of these settings.
                                    </p>
                                </div>

                                <div style="padding-top: 16px; border-top: 1px solid var(--border); margin-top: 20px;">
                                    <button type="submit" class="btn btn-primary">
                                        <svg style="width: 16px; height: 16px; margin-right: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                        Save Preferences
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Booking Activity Tab -->
                    <div id="activity-content" class="tab-content" style="display:none;">
                        <div style="margin-bottom: 24px;">
                            <h3 style="font-size: 18px; font-weight: 700; color: var(--dark); margin-bottom: 6px;">Recent Booking Activity</h3>
                            <p style="color: var(--text-secondary); font-size: 14px;">View your recent and upcoming reservations</p>
                        </div>

                        {% if upcoming_bookings %}
                        <div style="margin-bottom: 28px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                                <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--success-light) 0%, #a7f3d0 100%); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <svg style="width: 18px; height: 18px; color: var(--success);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                    </svg>
                                </div>
                                <h4 style="font-size: 15px; font-weight: 700; color: var(--dark); margin: 0;">Upcoming Trips ({{ upcoming_bookings|length }})</h4>
                            </div>
                            <div style="display: grid; gap: 12px;">
                                {% for booking in upcoming_bookings|slice:":5" %}
                                <div style="background: linear-gradient(to bottom, white 0%, var(--light) 100%); border: 1.5px solid var(--border-light); border-radius: var(--radius-lg); padding: 16px; transition: var(--transition-slow);" onmouseover="this.style.boxShadow='var(--shadow-md)'; this.style.borderColor='var(--border)'" onmouseout="this.style.boxShadow='none'; this.style.borderColor='var(--border-light)'">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; gap: 12px;">
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-weight: 700; font-size: 15px; color: var(--dark); margin-bottom: 4px;">{{ booking.passenger_name }}</div>
                                            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">
                                                 {{ booking.pick_up_date|date:"D, M j, Y" }} at {{ booking.pick_up_time }}
                                            </div>
                                            <div style="font-size: 13px; color: var(--text-secondary);"> {{ booking.pick_up_address|truncatewords:8 }}</div>
                                        </div>
                                        <span class="badge badge-{{ booking.status|lower }}">{{ booking.get_status_display }}</span>
                                    </div>
                                    <div style="padding-top: 12px; border-top: 1px solid var(--border-light);">
                                        <a href="{% url 'reservation_detail' booking.id %}" class="action-link">View Details →</a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 16px;">
                                <div style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary-light) 0%, #e2e8f0 100%); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <svg style="width: 18px; height: 18px; color: var(--primary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <h4 style="font-size: 15px; font-weight: 700; color: var(--dark); margin: 0;">Recent History</h4>
                            </div>

                            {% if recent_bookings %}
                            <div style="display: grid; gap: 10px;">
                                {% for booking in recent_bookings|slice:":8" %}
                                <div style="padding: 14px; border: 1px solid var(--border-light); border-radius: var(--radius); display: flex; justify-content: space-between; align-items: center; gap: 12px; transition: var(--transition); {% if booking.status == 'Cancelled' or booking.status == 'Cancelled_Full_Charge' %}opacity: 0.5; background-color: rgba(0,0,0,0.02);{% endif %}" onmouseover="{% if booking.status != 'Cancelled' and booking.status != 'Cancelled_Full_Charge' %}this.style.backgroundColor='var(--light)'{% endif %}" onmouseout="{% if booking.status != 'Cancelled' and booking.status != 'Cancelled_Full_Charge' %}this.style.backgroundColor='white'{% endif %}">
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="font-weight: 600; font-size: 14px; color: var(--dark); margin-bottom: 4px;">{{ booking.passenger_name }}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary);">{{ booking.pick_up_date|date:"M j, Y" }} • {{ booking.vehicle_type }}</div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span class="badge badge-{{ booking.status|lower }}" style="font-size: 11px; padding: 4px 10px;">{{ booking.get_status_display }}</span>
                                        <a href="{% url 'reservation_detail' booking.id %}" class="action-link" style="font-size: 12px; white-space: nowrap;">View</a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>

                            {% if total_bookings > 8 %}
                            <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-light);">
                                <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                                    View All Bookings ({{ total_bookings }})
                                    <svg style="width: 14px; height: 14px; margin-left: 6px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </a>
                            </div>
                            {% endif %}
                            {% else %}
                            <div style="text-align: center; padding: 40px 20px;">
                                <div style="width: 64px; height: 64px; background: var(--light); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                                    <svg style="width: 32px; height: 32px; color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                    </svg>
                                </div>
                                <p style="color: var(--text-secondary); margin-bottom: 16px;">No booking history yet</p>
                                <a href="{% url 'new_reservation' %}" class="btn btn-primary">Create Your First Reservation</a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Stat Card Styles - Matching Dashboard */
.stat-card {
    background: white;
    border-radius: var(--radius-lg);
    padding: 22px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-light);
    transition: var(--transition-slow);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent 0%, var(--border) 50%, transparent 100%);
    opacity: 0;
    transition: var(--transition);
}

.stat-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-3px);
    border-color: var(--border);
}

.stat-card:hover::before {
    opacity: 1;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-xs);
    position: relative;
}

.stat-icon::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, transparent 100%);
    pointer-events: none;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--dark);
    line-height: 1;
    letter-spacing: -0.03em;
}

.stat-label {
    color: var(--text-secondary);
    font-size: 13.5px;
    margin-bottom: 6px;
    font-weight: 600;
    letter-spacing: -0.01em;
}

/* Profile Tab Styles */
.profile-tab {
    flex: 1;
    padding: 16px 20px;
    background: none;
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    color: var(--text-secondary);
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    border-bottom: 3px solid transparent;
}

.profile-tab:hover {
    color: var(--primary);
    background: var(--light);
}

.profile-tab.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
    background: transparent;
}

.profile-tab svg {
    flex-shrink: 0;
}

/* Action Link Styles */
.action-link {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
}

.action-link:hover {
    color: var(--primary-hover);
    text-decoration: underline;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .stat-card {
        padding: 16px;
    }

    .stat-value {
        font-size: 24px;
    }

    .stat-icon {
        width: 42px;
        height: 42px;
    }

    .stat-icon svg {
        width: 20px !important;
        height: 20px !important;
    }
}

@media (max-width: 768px) {
    .profile-grid {
        grid-template-columns: 1fr !important;
    }

    .stat-card {
        padding: 14px;
    }

    .stat-icon {
        width: 38px;
        height: 38px;
    }

    .stat-value {
        font-size: 22px;
    }

    .stat-label {
        font-size: 12px;
    }

    .profile-tab {
        font-size: 12px;
        padding: 14px 12px;
    }

    .profile-tab svg {
        width: 14px !important;
        height: 14px !important;
        margin-right: 4px !important;
    }

    .profile-tab span {
        display: none;
    }
}

@media (max-width: 375px) {
    .stat-value {
        font-size: 20px;
    }

    .profile-tab {
        font-size: 11px;
        padding: 12px 8px;
    }
}
</style>

<script>
// Tab switching functionality
document.querySelectorAll('.profile-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        // Remove active state from all tabs
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));

        // Hide all tab content
        document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');

        // Activate clicked tab
        this.classList.add('active');

        // Show corresponding content
        const contentId = this.dataset.tab + '-content';
        const content = document.getElementById(contentId);
        if (content) {
            content.style.display = 'block';
        }
    });
});
</script>
{% endblock %}
