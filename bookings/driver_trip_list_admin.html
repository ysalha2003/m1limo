{% extends "base.html" %}

{% block title %}{{ driver.full_name }}'s Assignments{% endblock %}

{% block content %}

<style>
    .payment-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 32px;
    }

    .driver-trips-table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin: 0 -20px;
        padding: 0 20px;
    }

    .driver-trips-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .driver-trips-table thead {
        background: var(--light);
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .driver-trips-table th {
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--border);
        white-space: nowrap;
    }

    .driver-trips-table td {
        padding: 16px;
        border-bottom: 1px solid var(--border-light);
        vertical-align: top;
    }

    .driver-trips-table tbody tr:hover {
        background: var(--light);
    }

    .trip-number {
        font-weight: 600;
        color: var(--primary);
        text-decoration: none;
    }

    .trip-number:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .payment-stats-grid {
            grid-template-columns: 1fr;
        }

        .driver-info-header {
            font-size: 13px;
            word-break: break-word;
        }

        .driver-trips-table-wrapper {
            margin: 0 -16px;
            padding: 0 16px;
        }

        .driver-trips-table {
            font-size: 13px;
        }

        .driver-trips-table th,
        .driver-trips-table td {
            padding: 10px 12px;
        }

        .driver-trips-table th {
            font-size: 11px;
        }
    }

    @media (max-width: 640px) {
        /* Hide less important columns on mobile */
        .hide-on-mobile {
            display: none;
        }
    }
</style>

<div style="max-width: 1200px; margin: 0 auto;">
    <!-- Header -->
    <div style="margin-bottom: 32px;">
        <a href="{% url 'dashboard' %}" style="color: var(--primary); text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 12px;">
            <svg style="width: 16px; height: 16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Dashboard
        </a>
        <h1>{{ driver.full_name }}'s Trip Assignments</h1>
        <p class="driver-info-header" style="color: #64748b;">
            {{ driver.car_type }} ({{ driver.car_number }}) | {{ driver.phone_number }} | {{ driver.email }}
        </p>
    </div>

    <!-- Stats Cards -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px;">
        <div class="stat-card">
            <p class="stat-label">Total Trips</p>
            <p class="stat-value">{{ total_trips }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-label">Upcoming</p>
            <p class="stat-value" style="color: #3b82f6;">{{ upcoming_trips }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-label">Completed</p>
            <p class="stat-value" style="color: #059669;">{{ completed_trips }}</p>
        </div>
        <div class="stat-card">
            <p class="stat-label">Rejected</p>
            <p class="stat-value" style="color: #dc2626;">{{ rejected_trips }}</p>
        </div>
    </div>

    <!-- Payment Stats -->
    <div class="payment-stats-grid">
        <div style="background: #fff8e1; padding: 20px; border-radius: 12px; border-left: 4px solid #ffc107;">
            <p style="font-size: 13px; color: #856404; margin-bottom: 4px;">Total Owed (Unpaid)</p>
            <p style="font-size: 32px; font-weight: 700; color: #f57c00;">${{ total_owed }}</p>
        </div>
        <div style="background: #e8f5e9; padding: 20px; border-radius: 12px; border-left: 4px solid #4caf50;">
            <p style="font-size: 13px; color: #2e7d32; margin-bottom: 4px;">Total Paid</p>
            <p style="font-size: 32px; font-weight: 700; color: #2e7d32;">${{ total_paid }}</p>
        </div>
    </div>

    <!-- Trips Table -->
    <div class="card">
        <h2 class="card-title">All Assignments</h2>
        <div class="driver-trips-table-wrapper">
            <table class="driver-trips-table">
                <thead>
                    <tr>
                        <th>Trip #</th>
                        <th>Pickup Date & Time</th>
                        <th class="hide-on-mobile">Passenger</th>
                        <th>Route</th>
                        <th>Status</th>
                        <th>Payment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trip in trips %}
                    <tr>
                        <td><a href="{% url 'booking_detail' trip.id %}" class="trip-number">#{{ trip.id }}</a></td>
                        <td>
                            <div style="font-weight: 600; color: var(--dark);">{{ trip.pick_up_date|date:"M d, Y" }}</div>
                            <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">{{ trip.pick_up_time|time:"g:i A" }}</div>
                        </td>
                        <td class="hide-on-mobile">{{ trip.passenger_name }}</td>
                        <td style="max-width: 250px;">
                            <div style="overflow: hidden; text-overflow: ellipsis;">{{ trip.pick_up_address|truncatewords:5 }}</div>
                        </td>
                        <td>
                            {% if trip.driver_response_status == 'accepted' %}
                                <span class="badge badge-confirmed">Accepted</span>
                            {% elif trip.driver_response_status == 'rejected' %}
                                <span class="badge badge-cancelled">Rejected</span>
                            {% elif trip.driver_response_status == 'completed' %}
                                <span class="badge badge-trip_completed">Completed</span>
                            {% else %}
                                <span class="badge badge-pending">Pending</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if trip.driver_payment_amount %}
                                <div style="font-weight: 600; color: var(--dark);">${{ trip.driver_payment_amount }}</div>
                                {% if trip.driver_paid %}
                                    <div style="color: #10b981; font-size: 12px; margin-top: 4px;">✓ Paid</div>
                                {% else %}
                                    <div style="color: #f59e0b; font-size: 12px; margin-top: 4px;">⏳ Unpaid</div>
                                {% endif %}
                            {% else %}
                                <span style="color: #94a3b8;">N/A</span>
                            {% endif %}
                        </td>
                        <td>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <a href="{% url 'booking_detail' trip.id %}" class="btn btn-secondary" style="font-size: 13px; padding: 6px 14px;">View</a>
                                {% if trip.driver_response_status == 'completed' and trip.driver_payment_amount and not trip.driver_paid %}
                                    <a href="{% url 'mark_driver_paid' trip.id %}" class="btn btn-primary" style="font-size: 13px; padding: 6px 14px; white-space: nowrap;">Mark Paid</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
